<?xml version="1.0" encoding="US-ASCII"?>


<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [ 
<!-- One method to get references from the online citation libraries. 
     There has to be one entity for each item to be referenced.  
     An alternate method (rfc include) is described in the references.
-->

<!ENTITY RFC2460 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2460.xml">
<!ENTITY RFC8200 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8200.xml">
<!ENTITY I-D.draft-bogineni-dmm-optimized-mobile-user-plane SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-bogineni-dmm-optimized-mobile-user-plane-00.xml">

]> 
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?> 
<!-- used by XSLT processors --> 
<!-- For a complete list and description of processing instructions (PIs),  
      please see http://xml.resource.org/authoring/README.html. --> 
<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use. 
     (Here they are set differently than their defaults in xml2rfc v1.32) --> 
<?rfc strict="yes" ?> 
<!-- give errors regarding ID-nits and DTD validation --> 
<!-- control the table of contents (ToC) --> 
<?rfc toc="yes"?> 
<!-- generate a ToC --> 
<?rfc tocdepth="4"?> 
<!-- the number of levels of subsections in ToC. default: 3 --> 
<!-- control references --> 
<?rfc symrefs="yes"?> 
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] --> 
<?rfc sortrefs="yes" ?>

<!-- sort the reference entries alphabetically --> 
<!-- control vertical white space  
     (using these PIs as follows is recommended by the RFC Editor) --> 
<?rfc compact="yes" ?> 
<!-- do not start each main section on a new page --> 
<?rfc subcompact="no" ?> 
<!-- keep one blank line between list items --> 
<!-- end of list of popular I-D processing instructions --> 


<rfc category="info" docName="draft-hmm-dmm-5g-uplane-analysis-00">
  <!-- ***** FRONT MATTER ***** --> 




  <front>
    <title abbrev="draft-hmm-dmm-5g-uplane-analysis-00">
    User Plane Protocol and Architectural Analysis on 3GPP 5G System
    </title>



    <author fullname="Shunsuke Homma" initials="S." surname="Homma">
      <organization>NTT</organization>

      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country/>
        </postal>
        <email>homma.shunsuke@lab.ntt.co.jp</email>
      </address>
    </author>


    <author fullname="Takuya Miyasaka" initials="T." surname="Miyasaka">
      <organization>KDDI Research</organization>

      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country/>
        </postal>
        <email>ta-miyasaka@kddi-research.jp</email>
      </address>
    </author>
    
    <author fullname="Satoru Matsushima" initials="S." surname="Matsushima">
      <organization>SoftBank</organization>

      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country/>
        </postal>
        <email>satoru.matsushima@g.softbank.co.jp</email>
      </address>
    </author>

<!--
    <author fullname="Takashi Ito" initials="T." surname="Ito">
      <organization>NTT docomo</organization>

      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country/>
        </postal>
        <email>itoutakas@nttdocomo.com</email>
      </address>
    </author>
-->

    <author fullname="Daniel Voyer" initials="D." surname="Voyer">
      <organization>Bell Canada</organization>

      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country/>
        </postal>
        <email>daniel.voyer@bell.ca</email>
      </address>
    </author>

    
    <date year="2018"/>

    <area>Internet Area</area>

    <workgroup>DMM Working Group</workgroup>
    
    <keyword>I-D</keyword>

    <abstract>
        <t>
            This document analyzes the mobile user plane protocol and the
            architecture specified in 3GPP 5G documents. The analysis work is to
            clarify those specifications and to extract protocol and
            architectural requirements in terms of user plane from IETF side
            that is corresponding to the User Plane Protocol Study work on 3GPP
            side.
        </t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>
        This document analyzes the mobile user plane protocol and the
        architecture specified by 3GPP 5G documents. The background of the work
        is that 3GPP requests through a liaison statement that the IETF to
        provide any information for the User Plane Protocol Study work in 3GPP
        <xref target="CP-180116-3GPP"/>. Justification and the objectives of the
        study can be found from <xref target="CP-173160-3GPP"/>.
      </t>

      <t>
        We understand that the current user plane protocol, <xref
        target="TS.29.281-3GPP">GTP-U</xref>, has been well developed in 3GPP,
        and deployed very widely as the successor of legacy network
        technologies, such as TDM circuit, or ATM virtual circuit. That GTP-U
        success seems based on IP overlay technique that is dramatically scaled
        compare to the previous ones because it successfully isolates mobile
        session states from the user plane transport network.
      </t>
      
      <t>
        Even after that big success, it is definitely worth that 3GPP has
        decided to revisit user plane which seems to response to IPv6 deployment
        growth and <xref target="IAB-Statement"/> that encourages
        the industry to develop strategies for IPv6-only operation. It can be
        seen from the justification section in <xref target="CP-173160-3GPP"/>.
      </t>
      
      <t>
        The study description mentions that the study would be based on Release
        16 requirement while only Release 15 specifications has been available
        now. However we believe that to provide adequate information for 3GPP,
        we need to clearly understand what the current user plane protocol is in
        Release 15, and architectural requirements for the user plane.
      </t>
      
      <t>
        As the liaison statement indicates 3GPP specifications related to user
        plane, those documents should be a good start point to clarify their
        specifications and to extract protocol and architectural requirements
        from them.
      </t>

      <section title="Current Status of Mobile User Plane for 5G">
        <t>
          3GPP RAN and CT4 decided to use GTP-U as the 5G user plane
          encapsulation protocol over N3 and N9 that respectively described
          in<xref target="TS.38.300-3GPP" /> and <xref target="TR.29.891-3GPP"
          />. N3 is a interface between RAN and UPF and N9 is a interface
          between different UPFs <xref target="TS.23.501-3GPP" />.
        </t>

        <t>
          In <xref target="TR.29.891-3GPP"/>, it captured user plane
          requirements and concluded that GTP-U is adopted for the user plane
          protocol. It seems that GTP-U was only option to be chose and it
          focused on how to carry 5G specific QoS information between UPF and
          access networks. That is described in section 5.2 and 11.2 of <xref
          target="TR.29.891-3GPP"/>. Another aspects of user plane requirements
          couldn't be found. 
        </t>
      </section>
        
      <section title="Our Way of Analysis Work">
        <t>
          First, we analyze <xref target="TS.29.281-3GPP"/> for clarifying it
          as the current user plane protocol in the 5G system. <xref
          target="TR.29.891-3GPP"/> describes how GTP-U is selected as the user
          plane protocol for 5G in 3GPP. Clarified characteristics of the
          protocol are described in <xref target="gtp-u"/>. 
        </t>
      
        <t>
          Then, to clarify what are required to the user plane protocol in
          architecture level, we analyze <xref target="TS.23.501-3GPP"/> as the
          5G system architecture specification. <xref target="TS.23.502-3GPP"/> is
          the specification of system procesures that helps us to understand how
          the system works in the architecture. <xref target="TS.23.503-3GPP"/> is
          also helpful to find the role of user plane in the architecture that
          influences user plane protocol. Extracted architectural requirements are
          described in <xref target="arch"/>.
        </t>

        <t>
          Based on the results of above, we identify some aspects where there
          might be gap between the current user plane protocol and the
          architectural requirements on which <xref target="TR.29.891-3GPP"/> does
          not discuss. That aspects are discussed <xref target="eval_aspects"/>.
          That's we intend to be as a part of the reply to 3GPP. CT4 WG in 3GPP
          can utilize it as an input to evaluate the candidate protocols for user
          plane to the 5G system including current protocol.
        </t>
      
        <t>
          <xref target="I-D.bogineni-dmm-optimized-mobile-user-plane"/> will
          provide the candidate protocols on IETF side to the 3GPP study.
        </t>
      </section>
      
    </section>
      
    <section title="Terms and Abbreviations">

      <t>
        This section describes terms of functions and interfaces relevant to
        user plane protocol which we extract from the 3GPP specifications since
        this document focuses on user plane.
      </t>

      <t>
        In those specifications, there are so many unique terms and
        abbreviations in the 3GPP context which IETF community seems not
        familiar with. We will try to bring those terms with brief explanations
        to make sure common understanding for them.
      </t>

      
      <t>
        <list style="hanging">
        <t hangText="GTP:">
          GPRS Tunneling Protocol
        </t>
        
        <t hangText="GTP-U">
          User Plane part of GTP
        </t>

        <t>
          Noted that GTP version 1 (GTPv1-U) is the user-plane protocol
          specification which is defined in <xref target="TS.29.281-3GPP" />.
          Unless there is no specific annotation, we refer GTP-U to GTPv1-U in
          this document.
        </t>

        <t hangText="PDU:">
          Protocol Data Unit of end-to-end user protocol packet.
        </t>
      
        <t>
          Noted that the PDU in 3GPP includes IP header in case that PDU session
          type is IPv4 or IPv6. In contrast, in IETF it is supposed that PDU is
          the payload of IP packet so that it doesn't include  IP/TCP/UDP header
          in end-to-end.
        </t>

        <t hangText="T-PDU:">
          Transport PDU.
        </t>

        <t hangText="G-PDU:">
          GTP encapsulated user Plane Data Unit.
        </t>
        
        <t>
          GTP-U has above two notions on PDU. T-PDU is a PDU that GTP-U header
          encapsulates. G-PDU is a PDU that includes GTP-U header. A G-PDU may
          includes a T-PDU. G-PDU can be sent without T-PDU, but just with
          extension headers or TLV elements. It can be used for OAM related 
          operations.
        </t>


        <t hangText="PDU session:">
          Association between the UE and a Data Network that provides a PDU
          connectivity service.
        </t>
        
        <t hangText="Data Network (DN):">
          The network of operator services, Internet access or 3rd party services.
        </t>
        
        <t hangText="User Plane (UP):">
          Encapsulating user end-to-end PDU.
        </t>
        
        <t>
          In fact, we can't find exact text that defines UP in the
          architecture specification. However when we see the figure 8.3.1-1 in
          <xref target="TS.23.501-3GPP"/>, the layer right under PDU that
          directly encapsulates PDU. Underneath layers of UP are UP transport,
          such as IP/UDP, L2 and L1.
        </t>
        
        <t>
          However 3GPP is consistent to use the term user plane when they
          indicate that layer. In IETF, we can see the terms data plane, or
          forwarding plane as variations which often makes us tend to be
          confused in terminology.
        </t>

        <t hangText="QFI:">
          QoS Flow Identifier
        </t>
          
          
        <t hangText="UPF:">
          User Plane Function
        </t>
        
        <t hangText="SMF:">
          Session Management Function
        </t>
        
        <t>
          SMF is a control plane function which provides session management
          service that handling PDU sessions in the control plane. SMF allocates
          tunnels corresponding to the PDU sessions and configure the tunnel to
          the UPF.
        </t>

        <t hangText="RAN:">
          Radio Access Network
        </t>
        
        <t>
          Noted that UP protocol provides a RAN to connect UPF. But the UP
          protocol is not appeared on the air in the RAN.
        </t>

<!-- You can add terminologies which are important in this document -->

      </list>
      </t>
    </section>


    <section anchor="gtp-u" title="GTP-U Specification and Observation">
      <t>
        In this section we analyze the GTP-U specification and summarize
        clarified characteristic of GTP-U to see if GTP-U meets the requirements
        of 5G architecture for user plane in later section.
      </t>

      <section title="GTP-U Tunnel">
        <t>
          GTP-U is a tunneling protocol between GTP-U tunnel endpoint nodes and
          encapsulates T-PDU from UE on top of IP/UDP. TEID value allocated on
          each end point which tunnel indicates particular T-PDU belongs to.
          That is described in section 4.2.1 of <xref target="TS.29.281-3GPP" />.
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U is a Point-to-Point tunneling protocol.
            </t>
          </list>
        </t>
        <t>
          Point-to-Multipoint (P2MP) tunneling enables one sender tunnel
          endpoint node to multiple receiver tunnel endpoint nodes. The P2MP
          tunneling is used for MBMS (Multimedia Broadcast Multicast Service)
          through GTP-U described in section 4.2.6 of <xref
          target="TS.29.281-3GPP" />.
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U supports Point-to-Multipoint tunneling.
            </t>
          </list>
        </t>
        <t>
          <xref target="fig_Protocol-Stack-ul"/> and <xref target="fig_Protocol-Stack-dl"/> show examples of GTP-U protocol stack for uplink and downlink traffic respectively.
          Sender tunnel endpoint node encapsulates the IP packet from UE with GTP-U header, IPv4 or IPv6, and UDP.
          GTP-U tunnel is a uni-directional tunnel and in these two examples there are following four GTP-U tunnels:
          <list style="numbers">
            <t>
              A GTP-U Tunnel from RAN to UPF1 (TEID=1), UPF1 to UPF2 (TEID=2) in the uplink
            </t>
            <t>
              A GTP-U Tunnel from UPF2 to UPF1 (TEID=3), UPF1 to RAN (TEID=4) in the downlink
            </t>
          </list>
        </t>
        <figure anchor="fig_Protocol-Stack-ul" title="Protocol Stack by GTPv1-U for Uplink Traffic Flow">
          <artwork align="center"><![CDATA[
                 GTP-U Tunnel
         (TEID=1)            (TEID=2)
      ------------->      ------------->
+-----+    N3      +------+     N9     +------+
| RAN |------------| UPF1 |------------| UPF2 |
+-----+            +------+            +------+
       +---------+         +---------+
       |   L1    |         |   L1    |
       +---------+         +---------+
       |   L2    |         |   L2    |
       +---------+         +---------+
       |IPv4/IPv6|         |IPv4/IPv6|
       +---------+         +---------+
       |   UDP   |         |   UDP   |         +---------+
       +---------+         +---------+         |    L1   |
       |GTP-U Hdr|         |GTP-U Hdr|         +---------+
       |(TEID=1) |         |(TEID=2) |         |    L2   |
       +---------+         +---------+         +---------+
       |IPv4/IPv6|         |IPv4/IPv6|         |IPv4/IPv6|
       +---------+         +---------+         +---------+
       |   PDU   | ----->  |   PDU   | ----->  |   PDU   | ----->
       +---------+         +---------+         +---------+
]]></artwork>
        </figure>

        <figure anchor="fig_Protocol-Stack-dl" title="Protocol Stack by GTPv1-U for Downlink Traffic Flow">
          <artwork align="center"><![CDATA[
                 GTP-U Tunnel
         (TEID=4)            (TEID=3)
      <-------------      <-------------
+-----+    N3      +------+     N9     +------+
| RAN |------------| UPF1 |------------| UPF2 |
+-----+            +------+            +------+
       +---------+         +---------+
       |   L1    |         |   L1    |
       +---------+         +---------+
       |   L2    |         |   L2    |
       +---------+         +---------+
       |IPv4/IPv6|         |IPv4/IPv6|
       +---------+         +---------+
       |   UDP   |         |   UDP   |         +---------+
       +---------+         +---------+         |    L1   |
       |GTP-U Hdr|         |GTP-U Hdr|         +---------+
       |(TEID=4) |         |(TEID=3) |         |    L2   |
       +---------+         +---------+         +---------+
       |IPv4/IPv6|         |IPv4/IPv6|         |IPv4/IPv6|
       +---------+         +---------+         +---------+
<----- |   PDU   |  <----- |   PDU   |  <----- |   PDU   |
       +---------+         +---------+         +---------+
]]></artwork>
        </figure>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U supports load balancing by using dynamic UDP source port allocation.
            </t>
          </list>
          UDP is utilized for GTP-U encapsulation and UDP destination port is 2152 which is assigned by IANA.
          Allocation of UDP source port depends on sender tunnel endpoint node and GTP-U supports dynamic allocation of UDP source port for load balancing objective.
          The specification of this dynamic allocation is described in section 4.4.2.0 of <xref target="TS.29.281-3GPP" />,
          however specific procedure, e.g., 5-tuple hashing, is not described in the document and depends on the implementation of GTP-U tunnel endpoint node.
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              UDP zero checksum is not available in case of IPv6 transport.
            </t>
          </list>
          GTP-U supports both IPv4 and IPv6 as underlying transport layer protocol.
          As for IPv6, GTP-U specification refers <xref target="RFC2460"/>, which is described in section 4.2.3 of <xref target="TS.29.281-3GPP" />.
          As <xref target="RFC2460"/> does not allow the tunnel protocols on top of UDP to set the UDP checksum value to zero,
          the GTP-U specification inherits it while the IPv4 transport for GTP-U case allows UDP zero checksum.
          It is noted that the IPv6 specification in IETF has been updated to <xref target="RFC8200"/> which allows UDP zero checksum for the tunnel.
          If GTP-U support UFP zero checksum in future version, possible interoperability issue between previous generations which does not support zero checksum may raise.
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U does not support to response ICMP PTB for Path MTU Discovery.
            </t>
          </list>
          "Unnecessary fragmentation should be avoided" is recommended and to avoid the fragmentation operator should configure MTU size at UE <xref target="TS.29.281-3GPP" />.
          However, there's no reference and specification of Path MTU Discovery for IPv6 transport.
          If encapsulated IPv6 packet is too big on a network link between tunnel endpoint nodes,
          UE may not receive ICMPv6 Packet Too Big message and causes Path MTU Discovery black hole.
        </t>
      </section>
      <section title="GTP-U Header Format">
        <t>
          <xref target="fig_GTP-U_header" /> shows general and mandatory GTP-U header and <xref target="fig_GTP-U_Ext_header"/> shows extension GTP-U header.
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U supports sequence number option in the header, but it is not recommended to be used by almost GTP-U entities.
            </t>
          </list>
          GTP-U header has Sequence Number field to reorder incoming packets based on the sequence number.
          If Sequence Number Flag is set to '1' it indicates that Sequence Number Filed exists in GTP-U header and examined at receiving tunnel endpoint node to reorder incoming packets.
          However, the sequence number flag is set to '1' only for RAT HO procedure and sequence number flag should be set to '0' in normal case.
          Therefore, in normal case receiver tunnel endpoint node doesn't examine sequence number and can't reorder GTP-U packets based on the sequence number.
          This specification is described in section 5.1 of <xref target="TS.29.281-3GPP" />.
        </t>
          <figure anchor="fig_GTP-U_header" title="GTP-U Header">
          <artwork align="center"><![CDATA[
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Ver |P|R|E|S|N| Message Type|             Length              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                Tunnel Endpoint Identifier                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Sequence Number        |   N-PDU Number  |  Next-Ext-Hdr |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
        </figure>
        <t>
          <list style="symbols">
            <t>Ver: Version field (Set to '1')</t>
            <t>P: Protocol Type (Set to '1')</t>
            <t>R: Reserved bit (Set to '0')</t>
            <t>E: Extension Header Flag (Set to '1' if extension header exists)</t>
            <t>S: Sequence Number Flag (Set to '1' if sequence number exists)</t>
            <t>N: N-PDU Number Flag (Set to '1' if N-PDU number exists)</t>
            <t>Message Type: Indicates the type of GTP-U message</t>
            <t>Length: Indicates the length in octets of the payload</t>
            <t>Tunnel Endpoint Identifier (TEID)</t>
            <t>Sequence Number: Indicates increasing sequence number for T-PDUs is
               transmitted via GTP-U tunnels</t>
            <t>N-PDU Number: It is used only for inter SGSN, 2G-3G handover case, etc.</t>
            <t>Next-Ext-Hdr: Indicates following extension header type</t>
          </list>
        </t>

        <figure anchor="fig_GTP-U_Ext_header" title="Extension GTP-U Header">
        <artwork align="center"><![CDATA[
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Ext-Hdr Length|                                               |
+-+-+-+-+-+-+-+-+                                               |
|                  Extension Header Content                     |
.                                                               .
.                                               +-+-+-+-+-+-+-+-+
|                                               |  Next-Ext-Hdr |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
        </figure>
        <t>
          <list style="symbols">
            <t>Ext-Hdr Length: Represents the length of the Extension header in units of 4 octets</t>
            <t>Extension Header Content: Contains 3GPP related information</t>
            <t>Next-Ext-Hdr: Indicates following extension header type</t>
          </list>
        </t>

        <t>
          The extension GTP-U header is a variable-length and extendable header and contains 3GPP specific information.
          Following list summarizes every extension header which is used for user plane protocol. These extension headers are defined in <xref target="TS.29.281-3GPP" />.
          In this list Next-Ext-Hdr is represented in binary.

          <list style="symbols">
            <t>
              No more extension headers (Next-Ext-Hdr = 00000000)
            </t>
            <t>
              Service Class Indicator (Next-Ext-Hdr = 00100000)
            </t>
            <t>
              UDP Port (Next-Ext-Hdr = 01000000)
            </t>
            <t>
              RAN Container (Next-Ext-Hdr = 10000001)
            </t>
            <t>
              Long PDCP PDU Number (Next-Ext-Hdr = 10000010)
            </t>
            <t>
              Xw RAN Container (Next-Ext-Hdr = 10000011)
            </t>
            <t>
              NR RAN Container (Next-Ext-Hdr = 10000100)
            </t>
            <t>
              PDU Session Container (Next-Ext-Hdr = 10000101)
            </t>
            <t>
              PDCP PDU Number (Next-Ext-Hdr = 11000000)
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U supports carrying QoS Identifiers transparently for Access Networks in an extension headers.
            </t>
          </list>
          GTP-U is designed to carry 3GPP specific information with extension headers.
          3GPP creates PDU Session Container extension header for NGRAN of 5G to carry QFI.
          It is described in section 5.2.2.7 of <xref target="TS.29.281-3GPP" />.
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U supports DSCP marking based on the QFI.
            </t>
          </list>
          DSCP marking on outer IPv4 or IPv6 shall be set by sender tunnel endpoint node based on the QFI.
          This specification is described in section 4.4.1 of <xref target="TS.29.281-3GPP" />.
          However in <xref target="TS.29.281-3GPP" /> "DSCP marking based on QCI" is specified but "DSCP marking based on QFI" has not been noted.
          To support QFI of 5G QoS framework, it seems to need to update <xref target="TS.29.281-3GPP" />.
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U does not specify extension header order.
            </t>
          </list>
          Multiple GTP-U extension headers are able to contained in one GTP-U packet, however the order of extension header order is not specified in this document.
          Thereby the receiving endpoint can't predict exact position where the target extension headers are.
          This could impact on header lookup performance on the node.
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U does not support to indicate next protocol type.
            </t>
          </list>
          When Next-Ext-Hdr is set to 0x00 it indicates that no more extension headers follow.
          As GTP is designed to indicate protocol types for T-PDU by control-plane signaling,
          GTP-U doesn't have Next-Protocol-Header field to indicate the T-PDU type in the header.
        </t>
      </section>


      <section title="Control Plane Protocol for GTP-U">
        <t>
          Control plane protocol for GTP-U signals TEID between tunnel endpoint nodes.
          GTPv2-C <xref target="TS.29.274-3GPP" /> is the original control plane protocol tied with GTP-U
          in previous generation architectures before CUPS (Control and User Plane Separation).
        </t>
        <t>
          3GPP decided to use extended PFCP (Packet Forwarding Control Protocol) <xref target="TS.29.244-3GPP" /> for N4 interface <xref target="TR.29.891-3GPP" /> to signal tunnel states from SMF to UPF.
        </t>
      </section>
      <section title="GTP-U message">
        <t>
          GTP-U supports inband messaging to signal OAM. Currently GTP-U sipports following messages <xref target="TS.29.281-3GPP" />.
          <list style="symbols">
            <t>
              Echo Request
            </t>
            <t>
              Echo Response
            </t>
            <t>
              Supported Extension Headers Notification
            </t>
            <t>
              Error Indication
            </t>
            <t>
              End Marker
            </t>
            </list>
          </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U supports active OAM as a path management message "Echo Request/Response".
            </t>
          </list>
          A GTP-U tunnel endpoint node sends a Echo Request message to another nodes for keep-alive and received node sends a Echo Response message to sender node as acknowledgment.
          Echo Request message and Echo Response message are described in section 7.2.1 and section 7.2.2 of <xref target="TS.29.281-3GPP" /> respectively.
          <xref target="TR.29.891-3GPP" /> recommends not to send Echo Request message more often than 60s on each path.
        </t>
        <t>
          Supported Extension Headers Notification message indicates a list of supported that tunnel endpoint node can support.
          This message is sent only in case a tunnel endpoint node receives GTP-U packet with unsupported extension header.
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U supports tunnel management messages "Error Indication".
            </t>
          </list>
          GTP-U has Error Indication message to notify that the receiving endpoint discard packets of which no session exist to the sending endpoint.
          Error Indication message is described in section 7.3.1 of <xref target="TS.29.281-3GPP" />.
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u-2">
            <t>
              GTP-U supports tunnel management messages "End Marker".
            </t>
          </list>
          GTP-U has End Marker message to indicate the end of the payload stream that needs to be sent on a GTP-U tunnel.
          End Marker message is described in section 7.3.2 of <xref target="TS.29.281-3GPP" />.
        </t>
      </section>
      <section title="Packet Format">
        <t>
          <xref target="fig_GTP_stack_example" /> shows an packet format
          example of GTP-U over IPv6 that carries an extension header for QFI
          and an IPv6 PDU. All values in the example are illustration purpose
          only.
          The encoding of PDU Session Container for QFI refers to <xref target="TS.38.415-3GPP" />.
        </t>
        <figure anchor="fig_GTP_stack_example" title="GTP-U Protocol Stack Example">
          <artwork align="center"><![CDATA[
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
Outer IPv6 Header
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|     DSCP=EF   |               Flow Label              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Payload Length       | NxtHdr=17(UDP)|    Hop Limit  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                   Source IPv6 Address                         +
|                        2001:db8:1:1::1                        |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+              Destination IPv6 Address                         +
|                        2001:db8:1:2::1                        |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Outer UDP Header
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Source Port = xxxx        |         Dest Port = 2152      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         UDP Length            |    UDP Checksum (Non-zero)    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

GTP-U header
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| 0x1 |1|0|1|0|0|     0xff      |           Length              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           TEID = 1654                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Sequence Number = 0        |N-PDU Number=0 |NextExtHdr=0x85|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

GTP-U Extension Header (PDU Session Container)
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  ExtHdrLen=1  |Type=0 | Spare   |0|    QFI    |NextExtHdr=0x0 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Inner IPv6 Header
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|     DSCP=0    |               Flow Label              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Payload Length       |    NexttHdr   |    Hop Limit  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                   Source IPv6 Address                         +
|                        2001:db8:2:1::1                        |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+              Destination IPv6 Address                         +
|                        2001:db8:3:1::1                        |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Payload
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                                                               |
.                        TCP/UDP/etc., Data                     .
.                                                               .
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

]]></artwork>
        </figure>
      </section>
      <section anchor="gtp-u-summary" title="Observations Summary">
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              A Point-to-Point tunneling protocol.
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              Supports Point-to-Multipoint tunneling.
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              Supports load balancing by using dynamic UDP port allocation.
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              UDP zero checksum is not available in case of IPv6 transport.
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              Does not support to response ICMP PTB for Path MTU Discovery.
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              Supports sequence number option and sequence number flag in the header, but it is not recommended to be used by almost GTP-U entities.
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              Supports carrying QoS Identifiers transparently for Access Networks in extension headers.
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              Supports DSCP marking based on the QFI.
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              Does not specify the rule for the extension header order.
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              Does not support an indication of next-header type.
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              Supports active OAM as a path management message "Echo Request/Response".
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              Supports tunnel management messages "Error Indication".
            </t>
          </list>
        </t>
        <t>
          <list style="format [GTP-U-%d]:" counter="gtp-u">
            <t>
              Supports tunnel management messages "End Marker".
            </t>
          </list>
        </t>
      </section>
    </section>


    <section anchor="arch" title="5GS Architectural Requriements for User Plane Protocols">

      <section anchor="archi-overview" title="Overview of 5G System Architecture">
      <t>
      The 5G system is designed for applying to diverse devices and services such, and the UPP is 
      required to have capabilities for saticefying their requirements. 
<!--
      For example, a 5G system is expected to 
      provide the feasibility includes network slicing, network capability exposure, etc. (Ref. 
      <xref target="TS.22.261-3GPP"/>)
-->
      </t>
      
      <t>
      As a principle of the 5G system, User Plane (UP) functions are separated from the Control Plane (CP) 
      functions for allowing independent scalability, evolution and flexible deployments.
      </t>
      
      <t>
      Network slicing, one of the fundamental concepts of the 5G system, provides logical 
      network separation. In terms of user plane, multiple network slices can be established
      with UPFs on top of same physical network resources. Allocated resources and structures
      may be differentiated among the slices by which the required features or capabilities.
      </t>
      
      <t>
      The architecture overview is shown in <xref target="fig_3GPP-5GS-ARCH"/>. The details of 
      functions are described in <xref target="TS.23.501-3GPP"/>. User plane path and applied 
      functions for a tunnel will be manipulated based on application requirements that the 
      PDU session corresponding to the tunnel is available to be handled by other authorized 
      functions through the control plane.
      </t>

<figure anchor="fig_3GPP-5GS-ARCH"
        title="5GS Architecture and Service-based Interfaces">
  <artwork><![CDATA[



   +-----+  +-----+  +-----+     +-----+  +-----+  +-----+
   |NSSF |  | NEF |  | NRF |     | PCF |  | UDM |  | AF  |
   +--+--+  +--+--+  +--+--+     +--+--+  +--+--+  +--+--+
 Nnssf|    Nnef|    Nnrf|       Npcf|    Nudm|        |Naf
   ---+--------+--+-----+--+--------+--+-----+--------+-
             Nausf|    Namf|       Nsmf|
               +--+--+  +--+--+     +--+-------+
               |AUSR |  | AMF |     |    SMF   |
               +-----+  ++-+--+     +--+-----+-+ 
                        /  |           |      \
Control Plane        N1/   |N2         |N4     \N4
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
User Plane           /     |           |         \
                 +--++  +--+--+ N3  +--+--+ N9  +-+---+ N6 +-----+
                 |UE +--+(R)AN+-----+ UPF +-----+ UPF +----+ DN  |
                 +---+  +-----+     +--+--+     +-----+    +-----+
                                       |N6
                                    +--+--+
                                    | DN  |
                                    +-----+

 ]]></artwork>
</figure>

<!-- Should we add a figure of protocol stacks? -->


      <t>
      This document mainly focuses on requirements for N9 interface as relevant to UPP of 5G system.
      </t>
         
      <section anchor="UPF-Func" title="UPF Functionalities">
        <t>
          UPF has a role to handle UP traffic, and provides functionalities to 
          look up user data traffic and enforce the appropriate policies to it. 
        </t>
        
        <t>
          The followings are defined as UPF functionalities for traffic handlig:
        <list style="symbols">
          <t>User Plane part of policy rule enforcement, e.g. Gating, Redirection, Traffic steering)</t>
          <t>QoS handling for user plane, e.g. UL/DL rate enforcement, Reflective QoS marking in DL</t>
          <t>Transport level packet marking in the uplink and downlink</t>
        </list>
        </t>
        
        <t> 
          Other functionalities are described in the section 6.2.3 of <xref target="TS.23.501-3GPP"/>
        </t>
        
        <t>
          UPF shall detect user plane depending on information indecated by SMF.
          User data traffic is detected with combination of the following information:
        </t>
        <t>
        <list style="symbols">
          <t>For IPv4 or IPv6 PDU Session type
            <list style="symbols">
              <t>PDU Session</t>
              <t>QFI</t>
              <t>Application Identifier: The Application ID is an index to a set of application detection rules configured in UPF</t>
            </list>
          </t>
          <t>For Ethernet PDU Session type
            <list style="symbols">
              <t>PDU Session</t>
              <t>QFI</t>
              <t>Ethernet Packet Filter Set:
                <list style="symbols">
                  <t>Source/destination MAC address</t>
                  <t>Ethertype as defined in IEEE 802.3</t>
                  <t>Customer-VLAN tag(C-TAG) and/or Service-VLAN tag(S-TAG) VID fields as defined in IEEE 802.1Q</t>
                  <t>Customer-VLAN tag(C-TAG) and/or Service-VLAN tag(S-TAG) PCP/DEI fields as defined in IEEE 802.1Q</t>
                  <t>IP Packet Filter Set, in case Ethertype indicates IPv4/IPv6 payload</t>
                  <t>Packet filter direction</t>
                </list>
              </t>
            </list>
          </t>
          </list>
          </t>
          <t>
           Such information for traffic detection (Traffic Detection Information)
           is described in the section 5.8.2.4 of <xref target="TS.23.501-3GPP"/>.
          </t>
        </section>
      </section>
       
        

      <section anchor="archi-req" title="Architectural Requirements for User Plane Protocols">
      <t>
      This section lists the requirements for the UP protocol on the 5G system. The requirements are picked 
      up from <xref target="TS.23.501-3GPP"/>. In addition, some of service requirements described in 
      <xref target="TS.22.261-3GPP"/> are referred to clarify the originations of architectural requirements.
      </t>
    
      <t>
      According to <xref target="TS.23.501-3GPP"/>, the specifications potentially have assumptions that the user 
      plane protocol is a tunnel representing a single TEID between a pair of UPFs and it is corresponding to a 
      single PDU session. In short, the UP protocol is a tunnel and it is assumed to be managed under per 
      PDU session handling. Also, it should be a stateful tunnel in the UPFs along with the PDU session.
      </t>
    
      <t>
      The requirements for UPPs are described below:
      </t>
        
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            Supporting IPv4, IPv6, Ethernet and Unstructured PDU
          </t>
        </list>
      </t>
      <t> 
        The 5G system defines four types of PDU session as IPv4, IPv6, Ethernet, 
        and Unstractured. Therefore, UP protocol must support to convey all of 
        these PDU session types.  This is described in <xref target="TS.23.501-3GPP"/>.
      </t>
      
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            Supporting IP connectivity over N3, N6, and N9 interfaces 
          </t>
        </list>
      </t>
      
      <t>
        The 5G system provides IP connectivity over N3, N6, and N9 interfaces. 
      </t>
      
      <t>
         On N6 interface, point-to-point 
         tunneling based on UDP/IPv6 may be used to deliver unstructured PDU type data. Then, the content information
         of the PDU may be mapped into UDP port number, and the UDP port numbers is pre-configured in the UPF and DN.
         This is described in the section 9.2 of <xref target="TS.29.561-3GPP"/>.
      </t>
           
           
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
             Supporting deployment of multiple UPFs as anchors for a single PDU session 
          </t>
        </list>
      </t>
      
      <t>
        The 5G system allows to deploy multiple UPFs as anchors for a single 
        PDU session, and suupports multihoming of a single PDU session for 
        such anchor UPFs.
      </t>
      
      <t>
        Multihoming is provided with Branching Point (BP) or Uplink Classifier (UL CL) 
        which are functionalities of UPF. 
        BP provides forwarding of UL traffic towards the different PDU Session Anchors 
        based on the source IPv6 prefixes and merge of DL traffic to the UE. 
        UL CL provides destination based multihoming for load balancing.
      </t>
   
      <t>
        Multihoming of a single PDU session could be achieved by multiple P2P
        or a P2MP tunneling.  Simultaniously, in the revrsed direction, 
        multiple P2P or a MP2P tunneling would be used for supporting multihoming. 
        However, P2P tunneling might cause explosively 
        increase of the number of tunnles. For reducing total number of tunnel
        states, it would be better that UP protocol supports P2MP/MP2P tunneling.
      </t>
        
        
        
      <t>
        SSC mode 3 for session continuity in hand-over case uses a single PDU multihoming 
        with BP to make sure make-before-break. It is
        described in the section 5.6.4 and 5.6.9 of <xref target="TS.23.501-3GPP"/>. 
<!--
        Corresponding to specifications of SSC Mode 1 and 2, multi-homing for Ethernet type PDU session.
-->
      </t>
      
      <t>
        Multihoming is also assumed to be used for edge computing scenario. Edge computing enables some services
        to be hosted close to the UE's access point of attachment, and achieves an efficient service delivery 
        through the reduced end-to-end latency and load on the transport network. In edge computing, local 
        user's traffic is routed or steered to application in the local DN by UPF. This refers the section
        5.13 of <xref target="TS.23.501-3GPP"/>.
      </t>
        
<!-- (Multiple tunnels for multihomed PDU session may satisfy the above requirement)     
      <t>
        Thus, UP protocol would be required to support multihoming of a single PDU sesssion.
        Especially, UP protocol would be required to support P2MP and M2TP tunneling for reducing 
        managed tunnels.
      </t>
-->
      
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            Supporting flexible UPF selection for PDU compared to persistent S/P-GW in 4G.
          </t>
        </list>
      </t>
      <t>
        The appropriate UPFs are selected for a PDU session based on parameters
        and information such as UPF's dynamic load or UE location information.
        Examples of parameters and information are described in the section
        6.3.3 of <xref target="TS.23.501-3GPP"/>.
      </t>
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
             No limitation for number of UPFs in a data path
          </t>
        </list>
      </t>
      
      <t>
        The number of UPF in the data path is not constrained by 3GPP specifications.
        This specification is described in the section 8.3.1 of <xref target="TS.23.501-3GPP"/>.
      </t>
        
      <t>
        Putting multiple UPFs, which provides specific function, in a data path enables 
        flexible function deployment to make sure load distributin optimizations, etc.
      </t>
        
      <t>
        In addition, deployment of multiple UPFs as anchors closed to UEs' site and 
        connecting them without extra anchor points
        enable to make data path more efficient.  This usage is described in
        the section 6.5 of <xref target="TS.22.261-3GPP"/>. 
      </t>
        
      <t>
        It is exptected that multiple
        UPFs with per session tunnel handling for a PDU session becomes
        complicated task more and more for a SMF by increasing number of UPFs,
        and UP protocol shall support to aggregate several PDU sessions into a tunnel or
        shall be a session-less tunnel.
      </t>
<!--   (This paragraph seems to be leaping requirements which can be obtained from 23501)  
      <t>
        Moreover, in cases that a PDU session traverses multiple UPFs and is enforced
        some processes at each UPF, each UPF is required to
        identify the same PDU session and looks up the poilcy rules. For
        avoiding this redandant identifications, UPP might be required to convey
        identifiers represeinting subscription or allocated policy information. 
      </t>
-->           
      
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            A PDU session is able to aggregate multiple QoS Flow indicated with
            QFI.
          </t>
        </list>
      </t>
      <t>
        Against to the previous generation, 5G enables UPF to multiprex QoS
        Flows, equivarent with IP-CAN bearers in  the previous generation, into
        one single PDU session. That means that a single tunnel includes
        multiple QFIs contrast to just one QoS Flow (a bearer) to one tunnel
        before 5G. This specification is described in 5.7.1 of <xref
        target="TS.23.501-3GPP"/>.
      </t>
<!--
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            UPF supports several functionalities for handling PDU sessions, and
            some of them potentially have requiremts for UPP.
          </t>
        </list>
      </t>
      <t>
        For example, UPF supports packet routing and forwarding includes support
        of multi-homed PDU session. Also, UPF support QoS handling for user
        plane, e.g., UL/DL rate enforcement or QoS marking in DL, and UPP should
        be able to present QoS class with DSCP or CoS in the outer most header.
        The functionalities of UPF is described in the section 6.2.3 of <xref
        target="TS.23.501-3GPP"/>.
      </t>
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            UPF shall detect user plane depending on information indecated by
            SMF.
          </t>
        </list>
      </t>
      <t>
        User data traffic is detected with combination of the following
        information:
      </t>
      <t>
        <list style="symbols">
          <t>For IPv4 or IPv6 PDU Session type
            <list style="symbols">
              <t>PDU Session</t>
              <t>QFI</t>
              <t>Application Identifier: The Application ID is an index to a set of application detection rules configured in UPF</t>
            </list>
          </t>
          <t>For Ethernet PDU Session type
            <list style="symbols">
              <t>PDU Session</t>
              <t>QFI</t>
              <t>Ethernet Packet Filter Set:
                <list style="symbols">
                  <t>Source/destination MAC address</t>
                  <t>Ethertype as defined in IEEE 802.3</t>
                  <t>Customer-VLAN tag(C-TAG) and/or Service-VLAN tag(S-TAG) VID fields as defined in IEEE 802.1Q</t>
                  <t>Customer-VLAN tag(C-TAG) and/or Service-VLAN tag(S-TAG) PCP/DEI fields as defined in IEEE 802.1Q</t>
                  <t>IP Packet Filter Set, in case Ethertype indicates IPv4/IPv6 payload</t>
                  <t>Packet filter direction</t>
                </list>
              </t>
            </list>
          </t>
        </list>
      </t>
      <t>
        Such information for traffic detection (Traffic Detection Information)
        is described in the section 5.8.2.4 of <xref target="TS.23.501-3GPP"/>.
      </t>
-->
        
<!-- Any more requirements? -->
                                                                        
      </section>
    </section>
                                          
    <section anchor="eval_aspects" title="Evaluation Aspects">
      <t>
      This section provides examples of evaluation aspects for protocol comparison. The evaluation aspects are 
      led from architectural requirements of 5G system (<xref target="arch"/>) and some assumed service scenarios. 
      </t>
      
      <t>
      In addition, this section shows gap between GTP-U specifications and 5G architectural requirements.
      </t>
      
      <t>
      Note that the aspects on implementation and interoperability to current networks are out 
      of scope in this document. Moreover, this document does not define priority level of each aspect.
      </t>
         <section title="Supporting PDU Session Type Variations">
          <t>
          Given that UPP is required to support every PDU session type: IPv4, IPv6, Ethernet, and Unstructured. 
          If some types are not supported, UEs which use only such types of PDU session connect to the 5G network. 
          Or alternative means would be required to convey such PDU sessions.
          </t>
          
          <t>
          The point led from this aspect is whether the UPP has means to convey each type of PDU sessions.
          </t>
        </section>


        <section title="Forwarding Functionalities">
          <t>
          The 5G system defines that multi-homing of a single PDU session
          and multipoint-to-point forwarding in the reversed direction are supported for some
          purposes such as SSC mode 3or edge computing.  Thus, UP protocol would be
          required to  support mult-homing of a single PDU session.
          </t>
          
          <t>
          In terms of the number of required tunnels, UP protocol would be 
          required to support P2MP and MP2P tunneling.
          </t>
            
          <t>
          Meanwhile, GTP-U is basically P2P tunnel, and it also support P2MP forwarding. 
          However, GTP-U does not support MP2P tunneling.
          </t>
          
          <t>
          The point led from this aspect is whether the UP protocol support multihoming and both P2MP and MP2P tunneling.
          </t>
          
        </section>

        <section title="Supporting Transport Variations">
          <t>
          The 5G system has an assumption to use various types of transport for deploying base stations 
          for high-frequently radio access widely and high-density. In such cases, MTU size may vary depending on 
          transport technique type.
          </t>
          
          <t>
          For providing wide coverage, IPv6 should be used for transport and UP protocol should be IPv6-based. 
          In addition, for applying to such various types of transport techniques, UP protocol would be required to support 
          dynamic discovery and adjustment of MTU size.
          </t>
          
          <t>
          The points led from this aspect are that network structured with IPv6 and whether UP protocol support dynamic 
          discovery and adjustment of MTU size depending on transport type.
          </t>
        </section>


        <section title="Data Path Management">
          <t>
          In the 5G network, UPFs may be deployed distributedly, and UPFs which a data path traverses may vary 
          for UPF's load balancing or depending on service scenarios. In other words, UPF may be required to 
          connect a tunnel to another UPF dynamically, and the number of tunnels among UPFs would be large.
          </t>
          
          <t>
          From these reasons, UP protocol would be required to be session-less or allow to aggregate several PDU sessions to 
          a single tunnel for reducing the number of tunnels. Tunnel aggregation may require UP protocol to support 
          multipoint-to-point tunneling. 
          </t>
          
          <t>
          When UP protocol aggregates several PDU sessions, each PDU session must have unique identifiable information such 
          as non-duplicated 5-tuple for enabling to disaggregate them at each UPF. For example, some DN may use the same 
          IPv4 address space, and for avoiding duplicate of IP addresses among some PDU sessions, tunnels would be 
          established for each DN.
          </t>
          
          <t>
          The point led from this aspect is whether UP protocol is session-less tunneling or enables to aggregate several 
          PDU session into a single tunnel for preventing increase of complexity on tunnel management.
          </t>
          
        </section>


        <section title="QoS Control">
          <t>
          The 5G QoS model is based on QoS Flows, and a QFI is used to identify a QoS Flow. The 5G system has 
          an assumption that QFI is carried in an encapsulation header on N3 and N9. Moreover, UPFs optionally 
          support QoS marking on transport headers (e.g., DSCP of IP header or CoS of Ethernet header) depending 
          on QFI.
          </t>
          
          <t>
          Given that UP protocol is required to convey QFI on N3 and N9 interfaces. In terms of performance on hardware processes, 
          it is better to fix the place where QFI is contained. Moreover, for improving hardware processes 
          it may be better to content QFI value in a field of outer transporting header, such as a part of 
          destination IP address field.
          </t>
          
          <t>
          In GTP-U specifications, the order of QFI is not defined, and it may cause deterioration of
          forwarding throughput and interoperability. In addition, containing of QFI in an extension header 
          requires for UPF to parse the formats, and it would be a factor to decrease throughput performance.
          </t>
          
          <t>
          The points led from this aspect are whether UP protocol provides a field to convey QFI information over N3 and N9 interfaces 
          and the place containing the information is pre-defined for make hardware process more efficient.
          </t>
        </section>
        
        
        <section title="Traffic Detection and Flow Handling">
          <t>
          In the 5G network, there are cases that a PDU session traverses multiple UPFs. A UPF detects PDU session 
          based on Traffic Detect Information, and enforce some processes to the PDU based on the pre-configured 
          policy rule.
          </t>
          
          <t>
          Meanwhile, it's defined that several types of information can be used as TDI. This means that the place 
          TDI is contained may be different per PDU session and UPFs are required to monitor/search the whole of outer headers
          of each packet. This may cause decrease of forwarding performance of UPFs.
          </t>
          
          <t>
          For avoiding such redundant traffic detection, it may be better that UP protocol supports to convey optional 
          information such as policy rules in the pre-defined place and share with multiple UPFs.
          </t>
          
          <t>
          The points led from this aspect are whether UP protocol provides fields to contain some optional information such as 
          policy rules for reducing load of traffic detection.
          </t>
          
        </section>
        
        
        
        
        <section title="Supporting Network Slicing Diversity">
          <t>
          As described in <xref target="archi-overview"/>, a network slice is composed of UPFs belonging to
          the slice while a slice would share the physical resources with others. As <xref target="TS.28.530-3GPP"/>
          described in section 4, underlay transport network of UP and UPFs are shared with other network slices
          on the same networks. The data model defined in <xref target="TS.29.510-3GPP"/> allows that a UPF
          can belong to multiple slices as same as other type of NFs.
          </t>
          
          <t>
          Network slices would require different forwarding policies, in the intermediate transport network, depending 
          on requirements of the assumed services. Then, UP protocol would be required to represent such policies as the appropriate 
          format to the transport network. For example, in case that a slice has a requirement on forwarding latency and 
          dedicated route definition provided by TE is required, UP protocol would be required to convey the TE information as visible 
          for underlay transport network.
          </t>
          
          <t>
            Moreover, for more efficient usage of network resources, UPF and its (virtual) ports would be required 
            to allow multiple slices to use it simultaniously. If the a (virtual) port must be assigned to per slice, 
            the number of slices can be deployed is limited by the number of ports. In case that a port is shared with 
            multiple slices, a way to detect slices allocated to each PDU session would be required for executing the 
            appropriate processes to each slice. For example, UP protocol 
            might be required to convey some information for slice detection.
          </t>
            
            
            
    <!--      
          <t>
          Moreover, for monitoring traffic state of each network slice, UP protocol would be required to convey an identifier of slice 
          that the PDU session is allocated as visble to the operator. For example, UP protocol may be required to convey identifier 
          representing its allocated network slice as optional information. In network slicing 
          scenario, some UPFs may be shared with multiple network slices, and such identifier can be also used for reducing 
          loads of relay UPFs on slice detection. 
          </t>
    -->      
          
          <t>
          The points led from this aspect whether UP protocol supports to convey some optional information including forwarding 
          policy and slice identifier as the appropriate format for under transport network or other functions. 
          </t>
          
          <t> 
          As long as those slices share the resources in the networks, IP routing and
          transport system underneath the user plane have to be shared. It could mean that 
          the assumed slice operation, UPFs connect each other through direct (virtual)
          link, will restrict slicing instantiation techniques while no 3GPP specification 
          exist to specify the network slicing lifecycle. 
          </t>
          
          
        </section>
               

          
    </section>


    <section anchor="conclusion" title="Conclusion">
      <t>
        We analysed the 3GPP specifications of 5G architecture in terms of user
        plane and the current protocol adopted to the user plane. After the
        analysis work, we believe that the results described in this document
        shows that we reach at certain level of understanding on 5G systems and
        ready to provide our inputs to 3GPP.
      </t>
      
      <t>
        We clarified GTP-U through the analysis and listed observed
        characteristics in <xref target="gtp-u-summary"/>. We also clarified the
        architectural requirements for UP protocol described in <xref
        target="archi-req"/>.
      </t>
        
      <t>
        As we identify some potential gaps between current UP protocol and the
        architectural requirements, it is worth to study possible candidate UP
        protocols for the 5G system including current one. Our conclusion here
        is that we suggest the UP protocol study work in 3GPP takes into account
        the evaluation aspects described in <xref target="eval_aspects"/>. 
      </t>
      
    </section>

    <section title="Security Consideration">
    <t>TBD</t>
    </section>
    
    
    <section title="Acknowledgement">
    <t>
    The author would like to thank Arashmid Akhavain and Tom Harbert for reviewing various iterations of
    the document and for providing content into various sections. 
    </t>
    </section>

  </middle>

  <!-- ***** BACK MATTER ***** -->

  <back>

<!--
    <references title="Normative References">

    &RFC2119;

    </references>
-->    
    <references title="Informative References">

    &RFC2460;
    &RFC8200;
    &I-D.draft-bogineni-dmm-optimized-mobile-user-plane;

      <reference anchor='TR.29.891-3GPP' target="http://www.3gpp.org/FTP/Specs/2017-12/Rel-15/29_series/29891-f00.zip">
        <front>
        <title>3GPP TR 29.891 (V15.0.0): 5G System Phase 1, CT WG4 Aspects</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="December" year="2017"/>
        </front>
      </reference>

      <reference anchor='TS.29.244-3GPP' target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/29_series/29244-f10.zip">
        <front>
        <title>3GPP TS 29.244 (V15.1.0): Interface between the Control Plane and the User Plane Nodes; Stage 3</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='TS.29.281-3GPP' target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/29_series/29281-f20.zip">
        <front>
        <title>3GPP TS 29.281 (V15.2.0): GPRS Tunneling Protocol User Plane (GTPv1-U)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

<!--
      <reference anchor='TS.23.203-3GPP'>
        <front>
        <title>Policy and Charging Control Architecture, 3GPP TS 23.203 v2.0.1</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="December" year="2017"/>
        </front>
      </reference>
-->

      <reference anchor='TS.23.501-3GPP' target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/23_series/23501-f10.zip">
        <front>
        <title>3GPP TS 23.501 (V15.1.0): System Architecture for 5G System; Stage 2</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='TS.23.502-3GPP' target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/23_series/23502-f10.zip">
        <front>
        <title>3GPP TS 23.502 (V15.1.0): Procedures for 5G System; Stage 2</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='TS.23.503-3GPP'  target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/23_series/23503-f10.zip">
        <front>
        <title>3GPP TS 23.503 (V15.1.0): Policy and Charging Control System for 5G Framework; Stage 2</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='TS.38.300-3GPP'  target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/38_series/38300-f10.zip">
        <front>
        <title>3GPP TS 38.300 (v15.1.0): NR and NG-RAN Overall Description; Stage 2</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='TS.38.401-3GPP'  target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/38_series/38401-f10.zip">
        <front>
        <title>3GPP TS 38.401 (v15.1.0): NG-RAN; Architecture Description</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='TS.38.415-3GPP'  target="http://ftp.3gpp.org//Specs/archive/38_series/38.415/38415-100.zip">
        <front>
        <title>3GPP TS 38.415 (v1.0.0): NG-RAN; PDU Session User Plane protocol (work in progress)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="June" year="2018"/>
        </front>
      </reference>

      <reference anchor='TS.22.261-3GPP'  target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/22_series/22261-f40.zip">
        <front>
        <title>3GPP TS 22.261 (V15.4.0): Service requirements for 5G system stage 1</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

       <reference anchor='TS.29.561-3GPP'  target="http://www.3gpp.org/FTP/Specs/2018-06/Rel-15/29_series/29561-f00.zip">
        <front>
        <title>3GPP TS 29.561 (V15.0.0): 5G System; Interworking between 5G Network and external Data Networks; Stage 3</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="June" year="2018"/>
        </front>
      </reference>
         
       <reference anchor='TS.28.530-3GPP'  target="http://ftp.3gpp.org//Specs/archive/28_series/28.530/28530-100.zip">
        <front>
        <title>3GPP TS 28.530 (V1.0.0): Management and orchestration of networks and network slicing; Concepts,
               use cases and requirements (work in progress)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="June" year="2018"/>
        </front>
      </reference>

       <reference anchor='TS.29.510-3GPP'  target="http://www.3gpp.org/FTP/Specs/2018-06/Rel-15/29_series/29510-f00.zip">
        <front>
        <title>3GPP TS 29.510 (V15.0.0): 5G System; Network Function Repository Services; Stage 3</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="June" year="2018"/>
        </front>
      </reference>

       <reference anchor='TS.29.274-3GPP'  target="http://www.3gpp.org/ftp//Specs/archive/29_series/29.274/29274-f40.zip">
        <front>
        <title>3GPP TS 29.274 (V15.4.0): 3GPP Evolved Packet System (EPS); Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="June" year="2018"/>
        </front>
      </reference>

      <reference anchor='CP-180116-3GPP'  target="http://www.3gpp.org/ftp/tsg_ct/TSG_CT/TSGC_79_Chennai/Docs/CP-180116.zip">
        <front>
        <title>LS on user plane protocol study</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='CP-173160-3GPP'  target="http://www.3gpp.org/ftp/tsg_ct/TSG_CT/TSGC_78_Lisbon/Docs/CP-173160.zip">
        <front>
        <title>New Study Item on User Plane Protocol in 5GC</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="December" year="2017"/>
        </front>
      </reference>

      <reference anchor='IAB-Statement'  target="https://www.iab.org/2016/11/07/iab-statement-on-ipv6/">
        <front>
        <title>IAB Statement on IPv6</title>
        <author>
        <organization>
        Internet Architecture Board (IAB)
        </organization>
        </author>
        <date month="November" year="2016"/>
        </front>
      </reference>

    </references>



  </back>

</rfc>
