<?xml version="1.0" encoding="US-ASCII"?>


<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [ 
<!-- One method to get references from the online citation libraries. 
     There has to be one entity for each item to be referenced.  
     An alternate method (rfc include) is described in the references.
-->

<!ENTITY RFC2460 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2460.xml">
<!ENTITY RFC8200 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8200.xml">
<!ENTITY I-D.draft-bogineni-dmm-optimized-mobile-user-plane SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-bogineni-dmm-optimized-mobile-user-plane-00.xml">

]> 
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?> 
<!-- used by XSLT processors --> 
<!-- For a complete list and description of processing instructions (PIs),  
      please see http://xml.resource.org/authoring/README.html. --> 
<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use. 
     (Here they are set differently than their defaults in xml2rfc v1.32) --> 
<?rfc strict="yes" ?> 
<!-- give errors regarding ID-nits and DTD validation --> 
<!-- control the table of contents (ToC) --> 
<?rfc toc="yes"?> 
<!-- generate a ToC --> 
<?rfc tocdepth="4"?> 
<!-- the number of levels of subsections in ToC. default: 3 --> 
<!-- control references --> 
<?rfc symrefs="yes"?> 
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] --> 
<?rfc sortrefs="yes" ?>

<!-- sort the reference entries alphabetically --> 
<!-- control vertical white space  
     (using these PIs as follows is recommended by the RFC Editor) --> 
<?rfc compact="yes" ?> 
<!-- do not start each main section on a new page --> 
<?rfc subcompact="no" ?> 
<!-- keep one blank line between list items --> 
<!-- end of list of popular I-D processing instructions --> 


<rfc category="info" docName="draft-hmm-dmm-5g-uplane-analysis">
  <!-- ***** FRONT MATTER ***** --> 




  <front>
    <title abbrev="draft-hmm-dmm-5g-uplane-analysis-00">
    User Plane Protocol and Architectural Analysis on 3GPP 5G System
    </title>



    <author fullname="Shunsuke Homma" initials="S." surname="Homma">
      <organization>NTT</organization>

      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country/>
        </postal>
        <email>homma.shunsuke@lab.ntt.co.jp</email>
      </address>
    </author>


    <author fullname="Takuya Miyasaka" initials="T." surname="Miyasaka">
      <organization>KDDI Research</organization>

      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country/>
        </postal>
        <email>ta-miyasaka@kddi-research.jp</email>
      </address>
    </author>
    
    <author fullname="Satoru Matsushima" initials="S." surname="Matsushima">
      <organization>SoftBank</organization>

      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country/>
        </postal>
        <email>satoru.matsushima@g.softbank.co.jp</email>
      </address>
    </author>

    
    <date year="2018"/>

    <area>Internet Area</area>

    <workgroup>dmm</workgroup>
    
    <keyword>I-D</keyword>

    <abstract>
        <t>
            This document analyzes the mobile user plane protocol and the
            architecture specified in 3GPP 5G documents. The analysis work is to
            clarify those specifications and to extract protocol and
            architectural requirements in terms of user plane from IETF side
            that is corresponding to the User Plane Protocol Study work on 3GPP
            side.
        </t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>
        This document analyzes the mobile user plane protocol and the
        architecture specified by 3GPP 5G documents. The background of the work
        is that 3GPP requests through a liaison statement that the IETF to
        provide any information for the User Plane Protocol Study work in 3GPP
        <xref target="CP-180116-3GPP"/>. Justification and the objectives of the
        study can be found from <xref target="CP-173160-3GPP"/>.
      </t>
      
      <t>
        To provide adequate information for 3GPP, we need to clearly understand
        what the current user plane protocol in 5G is, and architectural
        requirements for the user plane.  As the liaison statement indicates 3GPP
        specifications related to user plane, those documents set should be a
        good start point to clarify their specifications and to extract protocol
        and architectural requirements from them.
      </t>
    
      <t>
        First, we analyze <xref target="TS.29.281-3GPP">GTP-U</xref> for
        clarifying it as the current user plane protocol in the 5G system. <xref
        target="TR.29.891-3GPP"/> describes how GTP-U is selected as the user
        plane protocol for 5G in 3GPP. GTP-U has been developed by 3GPP from
        previous generations, and it is widely deployed in existing mobile
        service networks.  Clarified characteristics of the protocol are
        described in <xref target="gtp-u"/>. 
      </t>
      
      <t>
        Then, to clarify what are required to the user plane protocol in
        architecture level, we analyze <xref target="TS.23.501-3GPP"/> as the
        5G system architecture specification. <xref target="TS.23.502-3GPP"/> is
        the specification of system procesures that helps us to understand how
        the system works in the architecture. <xref target="TS.23.503-3GPP"/> is
        also helpful to find the role of user plane in the architecture that
        influences user plane protocol. Extracted architectural requirements are
        described in <xref target="arch"/>.
      </t>

      <t>
        Based on the results of above, we identify some aspects where there
        might be gap between the current user plane protocol and the
        architectural requirements on which <xref target="TR.29.891-3GPP"/> does
        not discuss. That aspects are discussed <xref target="eval_aspects"/>.
        That's we intend to be as a part of the reply to 3GPP. CT4 WG in 3GPP
        can utilize it as an input to evaluate the candidate protocols for user
        plane to the 5G system including current protocol.
      </t>
      
      <t>
        <xref target="I-D.bogineni-dmm-optimized-mobile-user-plane"/> will
        provide the candidate protocols on IETF side to the 3GPP study.
      </t>
    </section>
      
    <section title="Terms and Abbreviations">

      <t>
        This section describes terms of functions and interfaces relevant to
        user plane protocol which we extract from the 3GPP specifications since
        this document focuses on user plane.
      </t>

      <t>
        In those specifications, there are so many unique terms and
        abbreviations in the 3GPP context which IETF community seems not
        familiar with. We will try to bring those terms with brief explanations
        to make sure common understanding for them.
      </t>

      
      <t>
        <list style="hanging">
        <t hangText="PDU:">
          Protocol Data Unit of end-to-end user protocol packet.
        </t>
      
        <t>
          Noted that the PDU in 3GPP includes IP header in case that PDU session
          type is IPv4 or IPv6. In contrast, in IETF it is supposed that PDU is
          the payload of IP packet so that it doesn't include  IP/TCP/UDP header
          in end-to-end.
        </t>

        <t hangText="PDU session:">
          Association between the UE and a Data Network that provides a PDU
          connectivity service.
        </t>
        
        <t hangText="Data Network (DN):">
          The network of operator services, Internet access or 3rd party services.
        </t>
        
        <t hangText="User Plane (UP):">
          Encapsulating user PDU.
        </t>
        
        <t>
          In fact, we can't find exact text that defines UP in the
          architecture specification. However when we see the figure 8.3.1-1 in
          <xref target="TS.23.501-3GPP"/>, the layer right under PDU that
          directly encapsulates PDU. Underneath layers of UP are UP transport,
          such as IP/UDP, L2 and L1.
        </t>
        
          
        <t hangText="User Plane Fuction (UPF):">
          An UPF handles the PDU sessions. An UPF is connected to SMF with N4
          interface. The 5G system allows to deploy two types of UPF; central
          UPF and local UPF. More detailed information is described in Section
          6.2.3 of <xref target="TS.23.501-3GPP"/>. 
        </t>

        <t hangText="Radio Access Network (RAN):">
          A RAN is an access network where radio bearer sent by UEs traverse. A
          RAN encapsulate users' packets with any encapsulation such as GTP-U.
        </t>

        <t hangText="Session Management Fuction (SMF):">
          An SMF is a function which provides control plane functionalities for
          handling UP for PDU sessions.
        </t>

<!-- You can add terminologies which are important in this document -->

      </list>
      </t>
    </section>


    <section anchor="gtp-u" title="GTPv1-U">
      <section title="Current Status of Mobile User Plane for 5G">
        <t>
          GTP is abbreviation of GPRS Tunneling Protocol and GTPv1-U is a user-plane specific protocol which is defined in <xref target="TS.29.281-3GPP" />.
          Unless there is no specific annotation, we refer to GTPv1-U as GTP-U in this document.
        </t>
        <t>
          3GPP RAN and CT4 decided to use GTP-U as the 5G user plane encapsulation protocol over N3 and N9
          respectively <xref target="TS.38.300-3GPP" /> <xref target="TR.29.891-3GPP" />.N3 is a interface between RAN and UPF and N9 is a interface between different UPFs <xref target="TS.23.501-3GPP" />.
          This section describes specifications of GTP-U and summarize the characteristic of GTP-U to see if GTP-U meets the requirements of 5G architecture for user plane in later section.
        </t>
      </section>
      <section title="GTP-U Specification">
        <section title="GTP-U Tunnel">
          <t>
            GTP-U is a tunneling protocol between GTP-U tunnel endpoint nodes and encapsulates T-PDU from UE with UDP+IP.
            <xref target="fig_Protocol-Stack-ul"/> and <xref target="fig_Protocol-Stack-dl"/> show examples of GTP-U protocol stack for uplink and downlink traffic respectively.
            Sender tunnel endpoint node encapsulates the IP packet from UE with GTP-U header, IPv4 or IPv6, and UDP.
            GTP-U tunnel is a uni-directional tunnel and in these two examples there are following four GTP-U tunnels:
            <list style="numbers">
              <t>
                GTP-U Tunnel from RAN to UPF1 in uplink traffic flow (TEID=1)
              </t>
              <t>
                GTP-U Tunnel from UPF1 to UPF2 in uplink traffic flow (TEID=2)
              </t>
              <t>
                GTP-U Tunnel from UPF2 to UPF1 in downlink traffic flow (TEID=3)
              </t>
              <t>
                GTP-U Tunnel from UPF1 to RAN in downlink traffic flow (TEID=4)
              </t>
            </list>
          </t>
          <figure anchor="fig_Protocol-Stack-ul" title="Protocol Stack by GTPv1-U for Uplink Traffic Flow">
            <artwork align="center"><![CDATA[

               N3                   N9
          GTP-U Tunnel         GTP-U Tunnel
           (TEID=1)              (TEID=2)
        ---------------->    ---------------->
  +-----+             +------+             +------+
  | RAN |-------------| UPF1 |-------------| UPF2 |
  +-----+             +------+             +------+

         +-----------+        +-----------+
         |    L1     |        |    L1     |
         +-----------+        +-----------+
         |    L2     |        |    L2     |
         +-----------+        +-----------+
         | IPv4/IPv6 |        | IPv4/IPv6 |
         +-----------+        +-----------+
         |    UDP    |        |    UDP    |         +-----------+
         +-----------+        +-----------+         |     L1    |
         | GTP-U Hdr |        | GTP-U Hdr |         +-----------+
         | (TEID=1)  |        | (TEID=2)  |         |     L2    |
         +-----------+        +-----------+         +-----------+
         | IPv4/IPv6 |        | IPv4/IPv6 |         | IPv4/IPv6 |
         +-----------+        +-----------+         +-----------+
         |    PDU    | -----> |    PDU    | ------> |    PDU    | ------>
         +-----------+        +-----------+         +-----------+

 ]]></artwork>
          </figure>

                    <figure anchor="fig_Protocol-Stack-dl" title="Protocol Stack by GTPv1-U for Downlink Traffic Flow">
            <artwork align="center"><![CDATA[

               N3                   N9
          GTP-U Tunnel         GTP-U Tunnel
           (TEID=4)              (TEID=3)
       <----------------    <----------------
  +-----+             +------+             +------+
  | RAN |-------------| UPF1 |-------------| UPF2 |
  +-----+             +------+             +------+

         +-----------+        +-----------+
         |    L1     |        |    L1     |
         +-----------+        +-----------+
         |    L2     |        |    L2     |
         +-----------+        +-----------+
         | IPv4/IPv6 |        | IPv4/IPv6 |
         +-----------+        +-----------+
         |    UDP    |        |    UDP    |         +-----------+
         +-----------+        +-----------+         |     L1    |
         | GTP-U Hdr |        | GTP-U Hdr |         +-----------+
         | (TEID=4)  |        | (TEID=3)  |         |     L2    |
         +-----------+        +-----------+         +-----------+
         | IPv4/IPv6 |        | IPv4/IPv6 |         | IPv4/IPv6 |
         +-----------+        +-----------+         +-----------+
 <------ |    PDU    | <----- |    PDU    | <------ |    PDU    |
         +-----------+        +-----------+         +-----------+

 ]]></artwork>
          </figure>

        </section>
        <section title="GTP-U Header Format">
          <t>
            <xref target="fig_GTP-U_header" /> shows general and mandatory GTP-U header and <xref target="fig_GTP-U_Ext_header"/> shows extension GTP-U header.
            The Tunnel Endpoint ID (TEID) which is present in the GTP-U header shall indicate which tunnel a particular T-PDU belongs to.
            TEID is signalled to GTP-U tunnel endpoint nodes from control plane function by using control plane protocol.
            In current 5G architecture, the control plane function is SMF and PFCP (Packet Forwarding Control Plane) is selected as the control plane protocol for N4 interface <xref target="TR.29.891-3GPP" />.
          </t>
            <figure anchor="fig_GTP-U_header" title="GTP-U Header">
            <artwork align="center"><![CDATA[
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 | Ver |P|R|E|S|N| Message Type|             Length              |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                Tunnel Endpoint Identifier                     |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |      Sequence Number        |   N-PDU Number  |  Next-Ext-Hdr |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
          </figure>
          <t>
            <list style="symbols">
              <t>Ver: Version field (Set to '1')</t>
              <t>P: Protocol Type (Set to '1')</t>
              <t>R: Reserved bit (Set to '0')</t>
              <t>E: Extension Header Flag (Set to '1' if extension header exists)</t>
              <t>S: Sequence Number Flag (Set to '1' if sequence number exists)</t>
              <t>N: N-PDU Number Flag (Set to '1' if N-PDU number exists)</t>
              <t>Message Type: Indicates the type of GTP-U message</t>
              <t>Length: Indicates the length in octets of the payload</t>
              <t>Tunnel Endpoint Identifier (TEID)</t>
              <t>Sequence Number: Indicates increasing sequence number for T-PDUs is
                 transmitted via GTP-U tunnels</t>
              <t>N-PDU Number: It is used only for inter SGSN, 2G-3G handover case, etc.</t>
              <t>Next-Ext-Hdr: Indicates following extension header type</t>
            </list>
          </t>

          <figure anchor="fig_GTP-U_Ext_header" title="Extension GTP-U Header">
          <artwork align="center"><![CDATA[
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 | Ext-Hdr Length|                                               |
 +-+-+-+-+-+-+-+-+                                               |
 |                  Extension Header Content                     |
 .                                                               .
 .                                               +-+-+-+-+-+-+-+-+
 |                                               |  Next-Ext-Hdr |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
          </figure>
          <t>
            <list style="symbols">
              <t>Ext-Hdr Length: The length of the Extension header shall be
                 defined in a variable length of 4 octets</t>
              <t>Extension Header Content: Contains 3GPP related information</t>
              <t>Next-Ext-Hdr: Indicates following extension header type</t>
            </list>
          </t>

          <t>
            The extension GTP-U header is a variable-length and extendable header and contains 3GPP specific information.
            Following list summarizes every extension header which is defined in <xref target="TS.29.281-3GPP" />.
            <list style="symbols">
              <t>
                No more extension headers (Next-Ext-Hdr = 0000 0000)
              </t>
              <t>
                Reserved - Control Plane only (Next-Ext-Hdr = 0000 0001)
              </t>
              <t>
                Reserved - Control Plane only (Next-Ext-Hdr = 0000 0010)
              </t>
              <t>
                Service Class Indicator (Next-Ext-Hdr = 0010 0000)
              </t>
              <t>
                UDP Port (Next-Ext-Hdr = 0100 0000)
              </t>
              <t>
                RAN Container (Next-Ext-Hdr = 1000 0001)
              </t>
              <t>
                Long PDCP PDU Number (Next-Ext-Hdr = 1000 0010)
              </t>
              <t>
                Xw RAN Container (Next-Ext-Hdr = 1000 0011)
              </t>
              <t>
                NR RAN Container (Next-Ext-Hdr = 1000 0100)
              </t>
              <t>
                PDU Session Container (Next-Ext-Hdr = 1000 0101)
              </t>
              <t>
                PDCP PDU Number (Next-Ext-Hdr = 1100 0000)
              </t>
              <t>
                Reserved - Control Plane only (Next-Ext-Hdr = 1100 0001)
              </t>
              <t>
                Reserved - Control Plane only (Next-Ext-Hdr = 1100 0010)
              </t>
            </list>
          </t>

          <t>
            If Next-Ext-Hdr is set to '0000 0000' it indicates that no more extension headers follows.
            However, GTP-U doesn't have a Next-Protocol-Header field which indicates the type of protocol of following T-PDU like IPv4.
            Therefore a control plane protocol needs to signal the type of protocol of T-PDU for each GTP-U tunnel.
          </t>
        </section>

        <section title="Control Plane Protocol for GTP-U">
          <t>
            Control plane protocol for GTP-U signals TEID to tunnel endpoint nodes and
            sender tunnel endpoint node encapsulates T-PDU with the signalled TEID.
            Once UE attachment is requested, control plane protocol signals TEID which is assigned to the PDU session to each tunnel end point node.
          </t>
          <t>
            3GPP CT4 proposed to use extended PFCP (Packet Forwarding Control Protocol) for N4 interface <xref target="TR.29.891-3GPP" />.
            PFCP is a control plane protocol for mobile user plane and running on UDP and IPv4/IPv6 <xref target="TS.29.244-3GPP" />.
          </t>
        </section>
        <section title="GTP-U signalling message">
          <t>
            GTP-U supports several signalling message for OAM and purpose. This section summarizes GTP-U signalling messages which are defined in <xref target="TR.29.891-3GPP" />.
          </t>
          <section title="Path Management Message">
            <t>
              For path management purpose, GTP-U supports following signalling messages.
              <list style="symbols">
                <t>
                  Echo Request
                </t>
                <t>
                  Echo Response
                </t>
                <t>
                  Supported Extension Headers Notification
                </t>
              </list>
            </t>
            <t>
              A GTP-U tunnel endpoint node sends a Echo Request message to another nodes for keep-alive and received node sends a Echo Response message to sender node as acknowledgment.
              <xref target="TR.29.891-3GPP" /> recommends not to send Echo Request message more often than 60s on each path.
            </t>
            <t>
              Supported Extension Headers Notification message indicates a list of supported that tunnel endpoint node can support.
              This message is sent only in case a tunnel endpoint node receives GTP-U packet with unsupported extension header.
            </t>
          </section>
          <section title="Tunnel Management Message">
            <t>
              For tunnel management purpose, GTP-U supports following signalling messages.
              <list style="symbols">
                <t>
                  Error Indication
                </t>
                <t>
                  End Marker
                </t>
              </list>
            </t>
            <t>
              If a tunnel endpoint node receive a GTP-U packet that TEID is not registered to the node, the node sends Error Indication message to sender tunnel endpoint node.
            </t>
            <t>
              End Marker message indicates the end of the payload stream that needs to be sent on a GTP-U tunnel.
            </t>
          </section>
        </section>
      </section>
      <section title="Observations on GTP-U Specification">
        <t>
          This section lists observations on GTP-U specification.
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U is a Point-to-Point tunneling protocol. 
            </t>
          </list>
        </t>
        <t>
          This characteristic is described in section 4.2.1 of <xref target="TS.29.281-3GPP" />.
          GTP-U tunnel is established between a given pair of tunnel endpoint nodes by using control plane protocol which signals common TEID value toward these two tunnel endpoint nodes.
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U supports Point-to-Multipoint tunneling.
            </t>
          </list>
        </t>
        <t>
          This characteristic is described in section 4.2.6 of <xref target="TS.29.281-3GPP" />.
          Multicast GTP-U tunnel is established from one sender node to multiple receiver nodes. This multicast GTP-U tunnel is used for MBMS(Multimedia Broadcast Multicast Service).
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U has no indication of next-header type.
            </t>
          </list>
        </t>
        <t>
          Receiving tunnel endpoint node can't identify which type of protocol exists under GTP-U encapsulation, this is because Next Header Tyoe information isn't encoded in GTP-U header.
          Therefore, control plane protocol must need to inform the PDU session type to GTP-U tunnel endpoint nodes.
          GTP-U header format is described in section 5.1 of <xref target="TS.29.281-3GPP" />.
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U has sequence number option and sequence number flag nu in the header, but it is not recommended to be used by almost GTP-U entities.
            </t>
          </list>
        </t>
        <t>
          However, sequence number flag should be set to "0" in normal case, this means receiving tunnel endpoint node doesn't examine sequence number and reorder GTP-U packets based on the sequence number.
          The sequence number flag is set to "1" only for RAT HO procedure.
          This specification is described in section 5.1 of <xref target="TS.29.281-3GPP" />.
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              "GTP-U supports carrying QoS Identifiers transparently for Access Networks in extension headers.
            </t>
          </list>
        </t>
        <t>
          PDU Session Container extension header carries QFI for NGRAN of 5G. This PDU Session Container is described in section 5.2.2.7 of <xref target="TS.29.281-3GPP" />.
          In this manner, GTP-U can carry 3GPP specific information by using extension header.
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U supports active OAM as a path management message "Echo Request/Response".
            </t>
          </list>
        </t>
        <t>
          GTP-U has Echo Request message and Echo Response message to find out if a GTP-U tunnel is alive.
          Echo Request message and Echo Response message are described in section 7.2.1 and section 7.2.2 of <xref target="TS.29.281-3GPP" /> respectively.
          Echo Request sending interval is recommended to be less than 60 seconds on each path.
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U supports tunnel management messages "End Marker".
            </t>
          </list>
        </t>
        <t>
          GTP-U has End Marker message to indicate the end of the payload stream that needs to be sent on a GTP-U tunnel.
          End Marker message is described in section 7.3.2 of <xref target="TS.29.281-3GPP" />.
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U supports tunnel management messages "Error Indication".
            </t>
          </list>
        </t>
        <t>
          GTP-U has Error Indication message to notify that the receiving endpoint discard packets of which no session exist to the sending endpoint.
          Error Indication message is described in section 7.3.1 of <xref target="TS.29.281-3GPP" />.
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U supports DSCP marking based on the QCI.
            </t>
          </list>
        </t>
        <t>
          DSCP marking on outer IPv4 or IPv6 shall be set by sender tunnel endpoint node based on the QCI.
          This specification is described in section 4.4.1 of <xref target="TS.29.281-3GPP" />.
          However 5G QoS model is different from QCI and utilize QFI (QoS Flow ID), so <xref target="TS.29.281-3GPP" /> may have to be revised to support DSCP marking based on "QFI" for 5G.
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U does not support UDP zero checksum in IPv6 transport case.
            </t>
          </list>
        </t>
        <t>
          Outer IPv6 encapsulation as a GTP-U transport case refers <xref
          target="RFC2460"/> described in section 4.2.3 of <xref
          target="TS.29.281-3GPP" />. As <xref target="RFC2460"/> does not
          allow the tunnel protocols on top of UDP to set the UDP checksum value
          to zero, the GTP-U specification inherits it while the IPv4 transport
          for GTP-U case allows UDP zero checksum. It is noted that the IPv6
          specification in IETF has been updated to <xref target="RFC8200"/>
          which allows UDP zero checksum for the tunnel. 
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U endpoint does not support to response ICMP PTB for Path MTU Discovery.
            </t>
          </list>
        </t>
        <t>
          There's no reference and specification of Path MTU Discovery for IPv6 transport in 3GPP <xref target="TS.29.281-3GPP" />.
          If encapsulated IPv6 packet is too big on a network link between tunnel endpoint nodes,
          UE may not receive ICMPv6 Packet Too Big message and causes Path MTU Discovery black hole.
          "Unnecessary fragmentation should be avoided" is only recommended by 3GPP and to avoid the fragmentation operator should configure MTU size at UE.
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U supports load balancing by using dynamic UDP port allocation.
            </t>
          </list>
        </t>
        <t>
          Sender tunnel endpoint node supports dynamic allocation of UDP source port for load balancing.
          This specification is described in section 4.4.2.0 of <xref target="TS.29.281-3GPP" />.
          However specific procedure and requirement (e.g. 5-tuple hashing) are not described in this document and depends on the implementation of GTP-U tunnel endpoint node.
        </t>
        <t>
          <list style="format GTP-U-%d:" counter="gtp-u">
            <t>
              GTP-U doesn't specify the rule for the extension header order.
            </t>
          </list>
        </t>
        <t>
          Section 5.2 of <xref target="TS.29.281-3GPP" /> specifies the extension header of GTP-U, however the rule for the extension header order is not specified in this document.
          There are many extension headers for GTP-U and a sender endpoint node can attach multiple extension header in one GTP-U header.
          This observation may cause a impact on hardware performance on receiving tunnel end point node
          because receiving end point node can't predict exact bit position of target extension header like PDU Container which contains QFI information and need to examine every extension header.
        </t>

      </section>
    </section>


    <section anchor="arch" title="5GS Architectural Requriements for User Plane Protocols">

      <section title="Overview of 5G System Architecture">
      <t>
      The 5G system is designed for applying to diverse devices and services such, and the UPP is 
      required to have capabilities for saticefying their requirements. For example, a 5G system is expected to 
      provide the feasibility includes network slicing, network capability exposure, etc. (Ref. 
      <xref target="TS.22.261-3GPP"/>)
      </t>
    
      <t>
      The 5G system is defined as a service-based architecture, and PDU sessions are available to be controlled 
      from other authorized network functions via control plane functions. The architecture overview is shown in 
      <xref target="fig_3GPP-5GS-ARCH"/>. The details of functions are described in <xref target="TS.23.501-3GPP"/>.
      </t>

<figure anchor="fig_3GPP-5GS-ARCH"
        title="5GS Architecture and Service-based Interfaces">
  <artwork><![CDATA[



   +-----+  +-----+  +-----+     +-----+  +-----+  +-----+
   |NSSF |  | NEF |  | NRF |     | PCF |  | UDM |  | AF  |
   +--+--+  +--+--+  +--+--+     +--+--+  +--+--+  +--+--+
 Nnssf|    Nnef|    Nnrf|       Npcf|    Nudm|        |Naf
   ---+--------+--+-----+--+--------+--+-----+--------+-
             Nausf|    Namf|       Nsmf|
               +--+--+  +--+--+     +--+-------+
               |AUSR |  | AMF |     |    SMF   |
               +-----+  ++-+--+     +--+-----+-+ 
                        /  |           |      \
Control Plane        N1/   |N2         |N4     \N4
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
User Plane           /     |           |         \
                 +--++  +--+--+ N3  +--+--+ N9  +-+---+ N6 +-----+
                 |UE +--+(R)AN+-----+ UPF +-----+ UPF +----+ DN  |
                 +---+  +-----+     +--+--+     +-----+    +-----+
                                       |N6
                                    +--+--+
                                    | DN  |
                                    +-----+

 ]]></artwork>
</figure>

<!-- Should we add a figure of protocol stacks? -->


      <t>
      This document mainly focuses on requirements for N9 interface as relevant to UPP of 5G system.
      </t>
      </section>


      <section title="Architectural Requirements for User Plane Protocols">
      <t>
      This section lists the requirements for the UPP on the 5G system. The requirements are picked 
      up from <xref target="TS.23.501-3GPP"/>. In addition, some of service requirements described in 
      <xref target="TS.22.261-3GPP"/> are referred to clarify the originations of architectural requirements.
      </t>
    
      <t>
      According to <xref target="TS.23.501-3GPP"/>, the specifications potentially have assumptions that the user 
      plane protocol is a tunnel representing a single TEID between a pair of UPFs and it is corresponding to a 
      single PDU session. In short, the UPP is a tunnel and it is assumed to be managed under per 
      PDU session handling. Also, it should be a stateful tunnel in the UPFs along with the PDU session.
      </t>
    
      <t>
      The requirements for UPPs are described below:
      </t>
        
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            IPv4, IPv6, Ethernet and Unstructured Packet Data Unit (PDU) are
            supported in the 5G system.
          </t>
        </list>
      </t>
      <t> 
        In short, UPP must support all of these PDU session types. This is refered in the section 3.1 of 
        <xref target="TS.23.501-3GPP"/>.
      </t>
      
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            The 5G system provides IP connectivity over N3, N6, and N9 interfaces. On N6 interface, point-to-point 
            tunneling based on UDP/IPv6 may be used to deliver unstructured PDU type data. Then, the content information
            of the PDU may be mapped into UDP port number, and the UDP port numbers is pre-configured in the UPF and DN.
            This is described in the section 9.2 of <xref target="TS.29.561-3GPP"/>.
          </t>
        </list>
      </t>
           
           
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            The 5G system allows to deploy multiple UPFs as anchors for a single
            PDU session, and a single PDU session supports multi-homing for such
            anchor UPFs. 
          </t>
        </list>
      </t>
      <t>
        Thus, UPP should be a multipoint-to-point tunnel in UL/DL to support the
        case of multihoming with a single PDU session. As examples of use cases
        that use multi-homing for a single PDU session, SSC Mode 1 and 2
        described in the section 5.6.4 and 5.6.9 of <xref
        target="TS.23.501-3GPP"/>. Corresponding to specifications of SSC Mode 1
        and 2, multi-homing for Ethernet type PDU session.
      </t>
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            The 5G system potentially supports flexible UPF selection for PDU
            compared to persistent S/P-GW in 4G.
          </t>
        </list>
      </t>
      <t>
        The appropriate UPFs are selected for a PDU session based on parameters
        and information such as UPF's dynamic load or UE location information.
        Examples of parameters and information are described in the section
        6.3.3 of <xref target="TS.23.501-3GPP"/>.
      </t>
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            There's no limitation for number of UPFs in a data plane path.
          </t>
        </list>
      </t>
      <t>
        This specification is described in the section 8.3.1 of <xref
        target="TS.23.501-3GPP"/>. Putting multiple UPFs in a data path enables
        to deploy functions as Application Function required through the path.
        In addition, putting multiple UPFs as anchors closed to UEs' site may
        enable to make data path more efficient. This usage is refered in the
        6.5 of <xref target="TS.22.261-3GPP"/>. It is exptected that multiple
        UPFs with per session tunnel handling for a PDU session becomes
        complicated task more and more for a SMF by increasing number of UPFs,
        and UPP shall support to aggregate several PDU sessions into a tunnel or
        shall be a session-less tunnel.
      </t>
      
      <t>
        Moreover, in cases that a PDU session traverses multiple UPFs and is enforced
        some processes at each UPF, each UPF is required to
        identify the same PDU session and looks up the poilcy rules. For
        avoiding this redandant identifications, UPP might be required to convey
        identifiers represeinting subscription or allocated policy information. 
      </t>
           
      
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            A PDU session is able to aggregate multiple QoS Flow indicated with
            QFI.
          </t>
        </list>
      </t>
      <t>
        Against to the previous generation, 5G enables UPF to multiprex QoS
        Flows, equivarent with IP-CAN bearers in  the previous generation, into
        one single PDU session. That means that a single tunnel includes
        multiple QFIs contrast to just one QoS Flow (a bearer) to one tunnel
        before 5G. This specification is described in 5.7.1 of <xref
        target="TS.23.501-3GPP"/>.
      </t>

      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            UPF supports several functionalities for handling PDU sessions, and
            some of them potentially have requiremts for UPP.
          </t>
        </list>
      </t>
      <t>
        For example, UPF supports packet routing and forwarding includes support
        of multi-homed PDU session. Also, UPF support QoS handling for user
        plane, e.g., UL/DL rate enforcement or QoS marking in DL, and UPP should
        be able to present QoS class with DSCP or CoS in the outer most header.
        The functionalities of UPF is described in the section 6.2.3 of <xref
        target="TS.23.501-3GPP"/>.
      </t>
      <t>
        <list style="format ARCH-Req-%d:" counter="arch-req">
          <t>
            UPF shall detect user plane depending on information indecated by
            SMF.
          </t>
        </list>
      </t>
      <t>
        User data traffic is detected with combination of the following
        information:
      </t>
      <t>
        <list style="symbols">
          <t>For IPv4 or IPv6 PDU Session type
            <list style="symbols">
              <t>PDU Session</t>
              <t>QFI</t>
              <t>Application Identifier: The Application ID is an index to a set of application detection rules configured in UPF</t>
            </list>
          </t>
          <t>For Ethernet PDU Session type
            <list style="symbols">
              <t>PDU Session</t>
              <t>QFI</t>
              <t>Ethernet Packet Filter Set:
                <list style="symbols">
                  <t>Source/destination MAC address</t>
                  <t>Ethertype as defined in IEEE 802.3</t>
                  <t>Customer-VLAN tag(C-TAG) and/or Service-VLAN tag(S-TAG) VID fields as defined in IEEE 802.1Q</t>
                  <t>Customer-VLAN tag(C-TAG) and/or Service-VLAN tag(S-TAG) PCP/DEI fields as defined in IEEE 802.1Q</t>
                  <t>IP Packet Filter Set, in case Ethertype indicates IPv4/IPv6 payload</t>
                  <t>Packet filter direction</t>
                </list>
              </t>
            </list>
          </t>
        </list>
      </t>
      <t>
        Such information for traffic detection (Traffic Detection Information)
        is described in the section 5.8.2.4 of <xref target="TS.23.501-3GPP"/>.
      </t>
           
<!-- Any more requirements? -->
                                                                        
      </section>
    </section>
                                          
    <section anchor="eval_aspects" title="Evaluation Aspects">
      <t>
      This section provides examples of evaluation aspects for protocol comparison. The evaluation aspects are 
      led from architectural requirements of 5G system (<xref target="arch"/>) and some assumed service scenarios. 
      </t>
      
      <t>
      In addition, this section shows gap between GTP-U specifications and 5G architectural requirements.
      </t>
      
      <t>
      Note that the aspects on implementation and interoperavility to current networks are out 
      of scope in this document. Moreover, this document does not define priority level of each aspect.
      </t>
        
        <section title="Limitation for UEs">
          <t>
          UPP would be required to support every PDU session type: IPv4, IPv6, Ethernet, and Unstractured. 
          If some types are not supported, UEs which use only such types of PDU session connect to the 5G network. 
          Or alternative means would be required to convey such PDU sessions.
          </t>
        </section>
        
        <section title="Forwarding Functionalities">
          <t>
          In the 5G system, multi-homing (multipoint-to-multipoint forwarding) is required for traffic 
          balancing or SSC modes. UPP would be required to support multi-homing.
          </t>
          
          <t>
          Meanwhile, GTP-U is point-to-point or multipoint-to-point tunnel protocol, and it may not satisfy 
          this requirement. 
          </t>
          
        </section>
        
        <section title="Supporting Various Traffic Patterns">
          <t>
          The 5G system is supportive for various types service scenarios, and traffic pattern would be 
          variable. For video streaming will require large packets for providing high throughput. 
          Also, in M2M communication, the rate of short packets will increase.
          </t>
          
          <t>
          For providing wide coverage, IPv6 should be used for transport and UPP should be IPv6-based. 
          In addition, for appliying to such various service scenarios, UPP would be required to support 
          dynamic discovery and adjustment of MTU size.
          </t>
        </section>
        
        <section title="Data Paths Management">
          <t>
          In the 5G network, UPFs may be deployed distributedly and UPFs which a data path traverses may vary 
          for UPF's load balancing or depending on service scenarios. In other words, UPF may be required to 
          connect a tunnel to another UPF dinamically, and the number of tunnels among UPFs would be large.
          </t>
          
          <t>
          From these reasons, UPP should be session-less or allow several PDU sessions to use the same tunnels 
          for reducing the number of tunnels.
          </t>
        </section>
        
        
        <section title="QoS Control on Mobile Network">
          <t>
          The 5G QoS model is based on QoS Flows, and a QFI is used to identify a QoS Flow. The 5G system has 
          an assumption that QFI is carried in an encapsulation header on N3 and N9. Moreover, UPFs optionally 
          support QoS marking on transport headers (e.g., DSCP of IP header or CoS of Ethernet header) depending 
          on QFI.
          </t>
          
          <t>
          UPP would be required to convey QFI as parameter of encapsulation header. Moreover, in terms of 
          performance on hardware processes, the order of QFI should be fixed.
          </t>
          
          <t>
          In GTP-U specifications, the order of QFI is not defined, and it may cause deterioration of
          forwarding throughput and interoperability.
          </t>
        </section>
        
        <section title="Traffic Flow Handling">
          <t>
          In the 5G network, there are cases that a PDU session traverses multiple UPFs. A UPF detects PDU session 
          based on Traffic Detect Information, and enforce some processes to the PDU based on the pre-configured 
          policy rule.
          </t>
          
          <t>
          The load of traffic detection is large. For avoiding such redundant traffic detection, it may be better 
          that UPP enables to convey optional information such as policy rules and share with some UPFs.
          </t>
        </section>
        
        <section title="Supporting Network Slicing">
          <t>
          Network slicing is a fundamental concept of the 5G system. A network slice is composed of some of network 
          functions and resources depending on service requirements, and some network slices may be established 
          on the same physical network. 
          </t>
          
          <t>
          For monitoring traffic state of each network slice, UPP should be capable to visualize its allocated network 
          slice. For example, UPP may be required to convey identifier of its allocated network slice as optional 
          information.
          </t>
        </section>
          
    </section>


    <section anchor="conclusion" title="Conclusion">
      <t>
        We analyse the 3GPP specifications of 5G architecture in terms of user
        plane and the current protocol adopted to the user plane. After the
        analysis work, we believe that the results described in this document
        clarify the user plane protocol and the architectural requirements to be
        ready to provide our inputs to the 3GPP User Plane Protocol Study work.
      </t>
      
      <t>
        An extensive study work on 5G architecture <xref
        target="TR.29.891-3GPP"/> captured user plane requirements and concluded
        that GTP-U is adopted for the user plane protocol. On the other hand, we
        identify some aspects where there might be gap between the current user
        plane protocol and the architectural requirements based on the results
        of the analysis.
      </t>
      
      <t>
        When it comes to the user plane study part in <xref
        target="TR.29.891-3GPP"/>, it seems that GTP-U was only option to be
        chose and it focused on how to carry 5G specific QoS information between
        UPF and access network. That is described in section 5.2 and 11.2 of
        <xref target="TR.29.891-3GPP"/>. Another aspects of user plane
        requirements couldn't be found. 
      </t>
      
      <t>
        We understand that GTP-U has been well developed and deployed very
        widely as the successor of legacy network technologies, such as TDM
        circuit, or ATM virtual circuit. That GTP-U success seems based on IP
        overlay technique that is dramatically scaled compare to the previous
        ones because it successfully isolates mobile session states from the
        user plane transport network.
      </t>
      
      <t>
        Even after that big success, we appreciate that 3GPP has decided to
        revisit user plane which seems to response to IPv6 deployment growth and
        IAB statement to other SDOs. It can be seen from the justification
        section in <xref target="CP-173160-3GPP">User Plane Protocol Study
        Description</xref>.
      </t>
        
      <t>
        The study description mentions that the study would be based on release
        16 requirement. However we believe that providing the analysis result
        based on release 15 specifications could also help to evolve their
        technology through the study work.
      </t>
      
    </section>

    <section title="Security Consideration">
    <t>TBD</t>
    </section>
    
    
    <section title="IANA Considerations">
    <t>TBD</t>
    </section>
    
    <section title="Acknowledgement">
    <t>
    The author would like to thank #TBD# for reviewing various iterations of
    the document and for providing content into various sections. 
    </t>
    </section>

  </middle>

  <!-- ***** BACK MATTER ***** -->

  <back>

<!--
    <references title="Normative References">

    &RFC2119;

    </references>
-->    
    <references title="Informative References">

    &RFC2460;
    &RFC8200;
    &I-D.draft-bogineni-dmm-optimized-mobile-user-plane;

      <reference anchor='TR.29.891-3GPP' target="http://www.3gpp.org/FTP/Specs/2017-12/Rel-15/29_series/29891-f00.zip">
        <front>
        <title>5G System Phase 1, CT WG4 Aspects, 3GPP TR 29.891 (V15.0.0)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="December" year="2017"/>
        </front>
      </reference>

      <reference anchor='TS.29.244-3GPP' target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/29_series/29244-f10.zip">
        <front>
        <title>Interface between the Control Plane and the User Plane Nodes; Stage 3, 3GPP TS 29.244 (V15.1.0)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='TS.29.281-3GPP' target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/29_series/29281-f20.zip">
        <front>
        <title>GPRS Tunneling Protocol User Plane (GTPv1-U), 3GPP TS 29.281 (V15.2.0)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

<!--
      <reference anchor='TS.23.203-3GPP'>
        <front>
        <title>Policy and Charging Control Architecture, 3GPP TS 23.203 v2.0.1</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="December" year="2017"/>
        </front>
      </reference>
-->

      <reference anchor='TS.23.501-3GPP' target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/23_series/23501-f10.zip">
        <front>
        <title>System Architecture for 5G System; Stage 2, 3GPP TS 23.501 (V15.1.0)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='TS.23.502-3GPP' target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/23_series/23502-f10.zip">
        <front>
        <title>Procedures for 5G System; Stage 2, 3GPP TS 23.502 (V15.1.0)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='TS.23.503-3GPP'  target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/23_series/23503-f10.zip">
        <front>
        <title>Policy and Charging Control System for 5G Framework; Stage 2, 3GPP TS 23.503 (V15.1.0)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='TS.38.300-3GPP'  target="">
        <front>
        <title>NR and NG-RAN Overall Description: Stage 2, 3GPP TS 38.300 (v2.0.0)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="December" year="2017"/>
        </front>
      </reference>

      <reference anchor='TS.38.401-3GPP'  target="">
        <front>
        <title>NG-RAN: Architecture Description, 3GPP TS 38.401 (v1.0.0)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="December" year="2017"/>
        </front>
      </reference>
      
      <reference anchor='TS.22.261-3GPP'  target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/22_series/22261-f40.zip">
        <front>
        <title>Service requirements for 5G system stage 1, 3GPP TS 22.261 (V15.4.0)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

       <reference anchor='TS.29.561-3GPP'  target="http://www.3gpp.org/FTP/Specs/2018-03/Rel-15/22_series/22261-f40.zip">
        <front>
        <title>5G System; Interworking between 5G Network and external Data Networks; Stage 3, 3GPP TS 29.561 (V1.4.0)</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="June" year="2018"/>
        </front>
      </reference>
         
      <reference anchor='CP-180116-3GPP'  target="http://www.3gpp.org/ftp/tsg_ct/TSG_CT/TSGC_79_Chennai/Docs/CP-180116.zip">
        <front>
        <title>LS on user plane protocol study</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="March" year="2018"/>
        </front>
      </reference>

      <reference anchor='CP-173160-3GPP'  target="http://www.3gpp.org/ftp/tsg_ct/TSG_CT/TSGC_78_Lisbon/Docs/CP-173160.zip">
        <front>
        <title>New Study Item on User Plane Protocol in 5GC</title>
        <author>
        <organization>
        3rd Generation Partnership Project (3GPP)
        </organization>
        </author>
        <date month="December" year="2017"/>
        </front>
      </reference>

    </references>



  </back>

</rfc>
